// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema
//run "npx prisma migrate dev" command to update schema 

generator client {
  provider = "prisma-client-js" 
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String        @id @default(cuid())
  name              String
  email             String        @unique
  password          String
  role              UserRole
  status            UserStatus
  created_on        DateTime      @default(now())
  updated_on        DateTime?  

  @@index(fields: [created_on])
  @@index(fields: [email])
}

model PublicGuild {
  id                String        @id @default(cuid())
  name              String        @unique
  description       String
  guild_leader      String?       @unique
  created_on        DateTime
  updated_on        DateTime?    
  status            ContentStatus

  languageId        String
  language          Language      @relation(fields: [languageId], references: [id])

  regionId          String
  region            Region        @relation(fields: [regionId], references: [id])

  @@index(fields: [created_on])
  @@index(fields: [created_on, name])
  @@index(fields: [name])
  @@index(fields:[regionId])
  @@index(fields:[languageId])
}

model AdminGuild {
  id                String        @id @default(cuid())
  name              String        @unique
  description       String
  guild_leader      String?       @unique
  created_on        DateTime
  updated_on        DateTime?    
  status            ContentStatus

  regionId          String
  region            Region        @relation(fields: [regionId], references: [id])

  languageId        String
  language          Language      @relation(fields: [languageId], references: [id])

  @@index(fields: [created_on])
  @@index(fields: [created_on, name])
  @@index(fields: [name])
  @@index(fields:[regionId])
  @@index(fields:[languageId])
}

model PublicContentCreator {
  id                String           @id @default(uuid())
  name              String           
  description       String
  videoUrl          String           
  created_on        DateTime        
  updated_on        DateTime? 
  status            ContentStatus   
  socials           Json?

  categories        ContentCategory[] @relation("PublicContentCategory")
  languageId        String
  language          Language      @relation(fields: [languageId], references: [id])
  
  @@index(fields: [created_on])
  @@index(fields: [created_on, name])
  @@index(fields: [name])
  @@index(fields:[languageId])
}

model AdminContentCreator {
  id                String           @id @default(uuid())
  name              String           
  description       String
  videoUrl          String           
  created_on        DateTime         
  updated_on        DateTime?     
  status            ContentStatus    
  socials           Json?

  categories        ContentCategory[] @relation("AdminContentCategory")
  languageId        String
  language          Language      @relation(fields: [languageId], references: [id])
  
  @@index(fields: [created_on])
  @@index(fields:[languageId])
}

model Category {
  id          String           @id @default(uuid())
  name        String           @unique
  description String?

  contentCreators ContentCategory[]
}

model ContentCategory {
  contentCreatorId String
  categoryId       String
  creatorType      ContentCreatorType // Enum to differentiate between public and admin creators

  // Relations to the corresponding content creator and category tables
  publicContentCreator   PublicContentCreator? @relation(fields: [contentCreatorId], references: [id], name: "PublicContentCategory", map: "PublicContentCategory_FK")
  adminContentCreator    AdminContentCreator?  @relation(fields: [contentCreatorId], references: [id], name: "AdminContentCategory", map: "AdminContentCategory_FK")
  category               Category              @relation(fields: [categoryId], references: [id])

  @@id([contentCreatorId, categoryId, creatorType])
  @@index(fields: [categoryId, contentCreatorId])
}

model Language {
  id                String        @id @default(uuid())
  name              String        @unique

  publicGuilds      PublicGuild[]
  adminGuilds       AdminGuild[]
  publicCreators    PublicContentCreator[]
  adminCreators     AdminContentCreator[]
}

model Region {
  id                String        @id @default(cuid())
  name              String        @unique

  publicGuilds      PublicGuild[]
  adminGuilds       AdminGuild[]
}

enum EntityType {
  PUBLIC_GUILD
  ADMIN_GUILD
  PUBLIC_CONTENT_CREATOR
  ADMIN_CONTENT_CREATOR
}

enum ContentCreatorType {
  PUBLIC_CONTENT_CREATOR
  ADMIN_CONTENT_CREATOR
}


enum ContentStatus {
  public
  private
  deleted
}

enum UserRole {
  user
  moderator
  admin
}

enum UserStatus {
  inactive
  active
  banned
  deleted
  locked
}



